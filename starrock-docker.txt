1. Create project folder					
	mkdir starrocks-gcs				
	cd starrocks-gcs				
					
					
2. Dockerfile					
	FROM starrocks/allin1-ubuntu:3.5-latest				
					
	# gcloud SDK 				
	RUN apt-get update && apt-get install -y curl apt-transport-https ca-certificates gnupg && \				
	    echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" \				
	        | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list && \				
	    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg \				
	        | gpg --dearmor -o /usr/share/keyrings/cloud.google.gpg && \				
	    apt-get update && apt-get install -y google-cloud-sdk && \				
	    apt-get clean				
					
				
	WORKDIR /data/deploy				
					
3. Build images					
	docker build -t starrocks-gcs .				
4. Create swith-key.sh in service_account folder:

#!/bin/bash
KEY_FILE=$1
if [ -z "$KEY_FILE" ]; then
  echo "‚ùå Please provide a key file, e.g.: switch-key.sh annoying-puzzle.json"
  exit 1
fi

FULL_PATH="/root/service_account/$KEY_FILE"

if [ ! -f "$FULL_PATH" ]; then
  echo "‚ùå Key file not found: $FULL_PATH"
  exit 1
fi

echo "üîë Switching to key: $FULL_PATH"
gcloud auth activate-service-account --key-file="$FULL_PATH"

gcloud auth list

4. Run container and service account:				
	Let's say your JSON service account is located at: C:\Users\PC\Downloads\annoying-puzzle.json
					
docker run -d \
  --name starrocks-gcs \
  -p 8030:8030 \
  -p 8040:8040 \
  -p 9050:9050 \
  -v C:/Users/PC/Downloads/service_account:/root/service_account \
  starrocks-gcs
					
5. Switch key if you want:
access container:
docker exec -it starrocks-gcs bash 
swtich key: 
bash /root/service_account/switch-key.sh annoying-puzzle.json
					
7. Demo Create External Tables in Starrocks:					
	CREATE EXTERNAL TABLE ext_transformed_events3 (				
	event_date STRING,				
	event_timestamp DATETIME,				
	event_name STRING,				
	user_pseudo_id STRING,				
	event_params STRING,				
	user_properties STRING,				
	geo STRING,				
	device STRING,				
	app_info STRING,				
	platform STRING,				
	traffic_source STRING,				
	event_value_in_usd DOUBLE,				
	retention_day INT				
	)				
	ENGINE=FILE				
	PROPERTIES (				
	"path" = "gs://brain-puzzle-tricky-test-export-demo/transform/",				
	"format" = "parquet",				
	"gcp.gcs.service_account_email" = "XXX",				
	"gcp.gcs.service_account_private_key_id" = "YYY",				
	"gcp.gcs.service_account_private_key" = "ZZZ"				
	);				
					
					
					
	SELECT event_date from ext_transformed_events10;				
					
8. Load local:
CREATE TABLE sticker_internal AS
SELECT * FROM FILES (
  "path" = "gs://sticker-room-c335b-export-demo/transformed/events_*/**.parquet",
  "format" = "parquet",
  "gcp.gcs.service_account_email" = "XXX",
  "gcp.gcs.service_account_private_key_id" = "YYY",
  "gcp.gcs.service_account_private_key" = "ZZZ"
);

					
					
					
					
					
					
					

					

